{% extends "base.html" %}
{% load static %}

{% block title %}My Subscriptions - Comic Aggregator{% endblock %}

{% block header %}
<link rel="stylesheet" href="{% static 'comics/css/comics.css' %}">
{% endblock %}

{% block content %}
<div class="my-subscriptions">
    <div class="page-header">
        <h1>My Subscriptions</h1>
        <p>Manage your webcomic subscriptions and view recent updates</p>
    </div>

    {% if subscriptions %}
    <div class="subscriptions-overview">
        <div class="overview-card">
            <h3>ðŸ“Š Overview</h3>
            <div class="overview-stats">
                <div class="stat">
                    <span class="stat-number">{{ subscriptions.count }}</span>
                    <span class="stat-label">Active Subscriptions</span>
                </div>
                <div class="stat">
                    <span class="stat-number">{{ recent_updates|length }}</span>
                    <span class="stat-label">Recent Updates</span>
                </div>
            </div>
        </div>
    </div>

    {% if recent_updates %}
    <div class="recent-updates-section">
        <h2>Recent Updates</h2>
        <div class="updates-grid">
            {% for update in recent_updates %}
            <div class="update-card">
                <div class="update-header">
                    {% if update.webcomic.icon %}
                    <img src="{{ update.webcomic.icon.url }}" alt="{{ update.webcomic.name }}" class="webcomic-icon">
                    {% else %}
                    <div class="webcomic-icon-placeholder">{{ update.webcomic.name|first|upper }}</div>
                    {% endif %}
                    <div class="update-info">
                        <h3>{{ update.webcomic.name }}</h3>
                        <p class="update-title">{{ update.latest_page.title }}</p>
                        <p class="update-date">{{ update.latest_page.comic_date }}</p>
                    </div>
                </div>
                <div class="update-actions">
                    <a href="{{ update.latest_page.comic_url }}" target="_blank" class="btn btn-primary">Read Now</a>
                    <a href="{% url 'comics:webcomic_detail' slug=update.webcomic.slug %}" class="btn btn-outline">View
                        Details</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="subscriptions-section">
        <h2>My Subscriptions</h2>
        <div class="subscriptions-grid">
            {% for subscription in subscriptions %}
            <div class="subscription-card">
                <div class="subscription-header">
                    {% if subscription.webcomic.icon %}
                    <img src="{{ subscription.webcomic.icon.url }}" alt="{{ subscription.webcomic.name }}"
                        class="webcomic-icon">
                    {% else %}
                    <div class="webcomic-icon-placeholder">{{ subscription.webcomic.name|first|upper }}</div>
                    {% endif %}
                    <div class="subscription-info">
                        <h3>{{ subscription.webcomic.name }}</h3>
                        {% if subscription.webcomic.author %}
                        <p class="author">by {{ subscription.webcomic.author }}</p>
                        {% endif %}
                        <p class="subscription-date">Subscribed: {{ subscription.subscribed_at|date:"M j, Y" }}</p>
                    </div>
                </div>

                <div class="subscription-settings">
                    <div class="notification-preferences">
                        <h4>Notifications</h4>
                        <div class="preferences-grid">
                            <div class="preference-item">
                                <span class="preference-label">Email:</span>
                                <span
                                    class="preference-value {% if subscription.email_notifications %}enabled{% else %}disabled{% endif %}">
                                    {% if subscription.email_notifications %}âœ“{% else %}âœ—{% endif %}
                                </span>
                            </div>
                            <div class="preference-item">
                                <span class="preference-label">RSS:</span>
                                <span
                                    class="preference-value {% if subscription.rss_enabled %}enabled{% else %}disabled{% endif %}">
                                    {% if subscription.rss_enabled %}âœ“{% else %}âœ—{% endif %}
                                </span>
                            </div>
                            <div class="preference-item">
                                <span class="preference-label">Discord:</span>
                                <span
                                    class="preference-value {% if subscription.discord_notifications %}enabled{% else %}disabled{% endif %}">
                                    {% if subscription.discord_notifications %}âœ“{% else %}âœ—{% endif %}
                                </span>
                            </div>
                            <div class="preference-item">
                                <span class="preference-label">Frequency:</span>
                                <span
                                    class="preference-value">{{ subscription.get_notification_frequency_display }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="subscription-actions">
                    <a href="{% url 'comics:subscription_settings' subscription_id=subscription.id %}"
                        class="btn btn-outline">Settings</a>
                    <a href="{% url 'comics:webcomic_detail' slug=subscription.webcomic.slug %}"
                        class="btn btn-outline">View Comic</a>
                    <form method="post" action="{% url 'comics:unsubscribe' subscription.webcomic.id %}"
                        class="inline-form">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Unsubscribe</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    {% else %}
    <div class="no-subscriptions">
        <div class="empty-state">
            <h3>No subscriptions yet</h3>
            <p>You haven't subscribed to any webcomics yet. Start exploring to find your favorites!</p>
            <div class="empty-actions">
                <a href="{% url 'comics:webcomic_list' %}" class="btn btn-primary">Browse Webcomics</a>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}