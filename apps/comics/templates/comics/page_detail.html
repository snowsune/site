{% extends "base.html" %}
{% load static %}
{% load comic_tags %}

{% block title %}{{ page.title }} - Page {{ page.page_number }} - snowsune.net{% endblock %}

{% block meta_keywords %}comic, webcomic, {{ page.title }}, page {{ page.page_number }}, snowsune{% endblock %}

{% block og_image %}{% if page.image %}{{ page.image.url }}{% else %}{% static 'placeholders/placeholder_wide.png' %}{% endif %}{% endblock %}
{% block twitter_image %}{% if page.image %}{{ page.image.url }}{% else %}{% static 'placeholders/placeholder_wide.png' %}{% endif %}{% endblock %}
{% block meta_description %}{{ page.description_html|striptags|truncatewords:30 }}{% endblock %}
{% block og_description %}{{ page.description_html|striptags|truncatewords:30 }}{% endblock %}
{% block twitter_description %}{{ page.description_html|striptags|truncatewords:30 }}{% endblock %}

{% block og_title %}{{ page.title }} - Page {{ page.page_number }} - snowsune.net{% endblock %}
{% block twitter_title %}{{ page.title }} - Page {{ page.page_number }} - snowsune.net{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/comics.css' %}">
{% endblock %}

{% block header %}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="index, follow">
<meta property="og:type" content="article">
<meta property="article:published_time" content="{{ page.published_at|date:'c' }}">
<meta property="article:modified_time" content="{{ page.updated_at|date:'c' }}">
<meta property="article:author" content="Vixi">
<meta property="article:section" content="Comics">
<link rel="canonical" href="{{ request.build_absolute_uri }}">

<!-- Twitter Card specific meta tags -->
<meta name="twitter:site" content="@snowsune">
<meta name="twitter:creator" content="@vixi">

<!-- Language and accessibility -->
<meta name="language" content="en">
<meta name="author" content="Vixi">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CreativeWork",
  "name": "{{ page.title }}",
  "description": "{{ page.description_html|striptags|truncatewords:30 }}",
  "image": "{% if page.image %}{{ page.image.url }}{% else %}{% static 'placeholders/placeholder_wide.png' %}{% endif %}",
  "url": "{{ request.build_absolute_uri }}",
  "creator": {
    "@type": "Person",
    "name": "Vixi"
  },
  "datePublished": "{{ page.published_at|date:'Y-m-d' }}",
  "dateModified": "{{ page.updated_at|date:'Y-m-d' }}",
  "genre": "Webcomic",
  "isPartOf": {
    "@type": "CreativeWorkSeries",
    "name": "snowsune.net Comics"
  }
}
</script>
{% endblock %}

{% block content %}
<div class="comic-page-detail">
    {% comic_frame page_number=page.page_number size='full' show_description=True %}

    <div class="comic-discussion-section">
        <h3>Discuss This Comic</h3>
        {% if page.blog_post %}
        <p>Join the discussion about this comic page!</p>
        <a href="{{ page.blog_post.get_absolute_url }}" class="btn btn-primary">
            View Discussion & Comments â†’
        </a>
        {% if user.is_staff %}
        <div class="staff-actions">
            <small>
                <a href="{% url 'admin:blog_blogpost_change' page.blog_post.id %}">
                    Edit Blog Post
                </a> |
                <a href="{% url 'admin:comics_comicpage_change' page.id %}">
                    Edit Comic Page
                </a>
            </small>
        </div>
        {% endif %}
        {% else %}
        <p>No discussion thread created yet for this comic page.</p>
        {% if user.is_staff %}
        <div class="staff-actions">
            <p><em>Staff: You can create a discussion thread by editing this comic page in the admin.</em></p>
            <a href="{% url 'admin:comics_comicpage_change' page.id %}" class="btn btn-secondary">
                Create Discussion Thread
            </a>
        </div>
        {% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}