{% extends "base.html" %}

{% block title %}{{ guild.name }} - Fops Bot Manager{% endblock %}

{% block content %}
<h1>{{ guild.name }}</h1>

<p><a href="{% url 'bot_manager_dashboard' %}">‚Üê Back to Dashboard</a></p>

{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }}">{{ message }}</div>
{% endfor %}
{% endif %}

<h2>Guild Settings</h2>
<table>
    <tr>
        <th>Guild ID</th>
        <td>{{ guild.guild_id }}</td>
    </tr>
    <tr>
        <th>Name</th>
        <td>{{ guild.name }}</td>
    </tr>
    <tr>
        <th>Joined At</th>
        <td>{{ guild.joined_at }}</td>
    </tr>
    {% if guild.settings %}
    <tr>
        <th>Settings</th>
        <td>
            <pre>{{ guild.settings }}</pre>
        </td>
    </tr>
    {% endif %}
    {% if guild.features %}
    <tr>
        <th>Features</th>
        <td>{{ guild.features }}</td>
    </tr>
    {% endif %}
</table>

<h2>Channels</h2>
{% if channels %}
<table>
    <thead>
        <tr>
            <th>Type</th>
            <th>Name</th>
            <th>ID</th>
        </tr>
    </thead>
    <tbody>
        {% for channel in channels %}
        <tr>
            <td>
                {% if channel.type == 0 %}
                üí¨ Text
                {% elif channel.type == 5 %}
                üì¢ Announcement
                {% else %}
                {{ channel.type }}
                {% endif %}
            </td>
            <td>{{ channel.name }}</td>
            <td>{{ channel.id }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No channels found (you may not have permissions to view channels).</p>
{% endif %}

<h2>Guild Subscriptions</h2>
{% if subscriptions %}
<table>
    <thead>
        <tr>
            <th>Service</th>
            <th>Search Criteria</th>
            <th>Channel</th>
            <th>PM</th>
            <th>Subscribed</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for sub in subscriptions %}
        <tr>
            <td>{{ sub.service_type }}</td>
            <td>{{ sub.search_criteria }}</td>
            <td>{{ sub.channel_id }}</td>
            <td>{{ sub.is_pm|yesno:"Yes,No" }}</td>
            <td>{{ sub.subscribed_at }}</td>
            <td>
                <a href="{% url 'bot_manager_edit_subscription' sub.id %}">Edit</a> |
                <a href="{% url 'bot_manager_delete_subscription' sub.id %}"
                    onclick="return confirm('Delete this subscription?')">Delete</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No subscriptions for this guild.</p>
{% endif %}

<a href="{% url 'bot_manager_add_subscription' %}">Add New Subscription</a>
{% endblock %}