{% extends "base.html" %}
{% load static %}

{% block og_image %}{% static 'bot_manager/images/FopsCard.png' %}{% endblock %}
{% block twitter_image %}{% static 'bot_manager/images/FopsCard.png' %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'bot_manager/bot_manager.css' %}">
{% endblock %}

{% block content %}
<h1>Fops Bot</h1>

<div class="info-box">
    <h2>About Fops Bot</h2>
    <p>Fops is my own discord bot! There were just so many tools and things I wanted to have around. I keep fops
        maintained for my own server but I always try and make the features useful for everyone! You're more than
        welcome to invite fops into your own server. Let me know if you find any bugs ever or have suggestions!</p>

    <h3>Subscription System</h3>
    <p>Fops can subscribe and follow certain art posting and publishing platforms in your discord channels! You can
        manage and control these in the per-guild manager below!</p>

    <h4>Supported Services</h4>
    <ul>
        <li><strong>BixiBooru</strong> - Follow tags and subscriptions on my booru</li>
        <li><strong>FurAffinity</strong> - Monitor your favorite FA artists!</li>
    </ul>

    <h3>Getting Started</h3>
    <ol>
        <li><a href="{% url 'login' %}" class="button">Login to Snowsune.net</a></li>
        <li>Connect your Discord account</li>
        <li>Invite Fops Bot to your server</li>
        <li>Configure subscriptions, holes, features and whatever else!</li>
    </ol>

    <p><strong>Invite Fops Bot:</strong> <a
            href="https://discord.com/oauth2/authorize?client_id=983461462896963744&scope=bot&permissions=412384378880"
            target="_blank">Click here to invite</a></p>

    If you need help, contact me on Discord or email me at <a href="mailto:vixi@snowsune.net">vixi@snowsune.net</a>!
</div>

{% if show_discord_login %}
<div class="alert alert-info">
    <strong>Connect Discord:</strong> You need to connect your Discord account to manage Fops Bot.
    <br>
    <a href="{% url 'bot_manager_discord_login' %}" class="button">Connect Discord Account</a>
</div>
{% endif %}

<h2>Your Shared Guilds with Fops Bot</h2>

{% if not user.is_authenticated %}
<p>You're not logged in! You can login <a href="{% url 'login' %}" class="button">here</a></p>
{% else %}

{% if guilds_error %}
<div class="alert alert-error">
    <strong>Error loading guilds:</strong> {{ guilds_error }}
    <br>
    <small>Try refreshing the page or <a href="{% url 'bot_manager_discord_login' %}">reconnecting Discord</a>.</small>
</div>
{% elif shared_guilds is None %}
<div class="alert alert-error">
    <strong>Unable to fetch your guilds.</strong>
    <br>
    <small>Try refreshing the page or <a href="{% url 'bot_manager_discord_login' %}">reconnecting Discord</a>.</small>
</div>
{% elif shared_guilds %}
<table>
    <thead>
        <tr>
            <th>Server</th>
            <th>Admin Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for guild in shared_guilds %}
        <tr>
            <td>
                {% if guild.icon %}
                <img src="https://cdn.discordapp.com/icons/{{ guild.id }}/{{ guild.icon }}.png" width="32" height="32"
                    style="border-radius: 50%; margin-right: 8px;">
                {% endif %}
                <a href="https://discord.com/channels/{{ guild.id }}" target="_blank">{{ guild.name }}</a>
            </td>
            <td>
                {% if guild.is_admin %}
                <span style="color: green;">✓ Admin</span>
                {% else %}
                <span style="color: red;">✗ Not Admin</span>
                {% endif %}
            </td>
            <td>
                {% if guild.is_admin %}
                <a href="{% url 'bot_manager_guild' guild_id=guild.id %}">Configure →</a>
                {% else %}
                <span style="color: gray;">No Access</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p>No shared guilds found. If you share a server with fops bot, try refreshing this page in a few seconds!</p>
{% endif %}
{% endif %}

{% endblock %}